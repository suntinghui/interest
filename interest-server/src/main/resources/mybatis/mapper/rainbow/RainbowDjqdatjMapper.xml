<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.interest.dao.rainbow.RainbowDjqdatjDao">

	<!-- 设备档案，添加分页 -->
	<select id="getDeviceInfoList" resultType="java.util.HashMap">
		select a.DDI_No 机器编号,a.SHOP_No 网点编号,a.DSI_Try 启用时间,c.SHOP_Address 设备位置,b.DDI_Type 设备类型
		from study.t_device_sub_info a left join t_device_device_info b
		on a.DDI_No = b.DDI_No
		left join netfiance_db.t_shop_shop_info c
		on a.SHOP_No = c.SHOP_No
		LEFT JOIN netfiance_db.t_shop_agent_list f
		ON c.SHOP_AGUid = f.AGNT_Uid
		LEFT JOIN netfiance_db.t_shop_agent_top g
		ON f.AGNT_ATUid = g.ATOP_Uid
		left join study.t_shop_sub_info d
		on c.SHOP_Uid = d.SHOP_Uid
		left join (select DICT_Value,DICT_Name from netfiance_db.t_sys_dictionary_info where DICT_Field = 'shop_class' ) t
		on t.DICT_Value = c.SHOP_Class

		limit #{pageWrapper.start},#{pageWrapper.pageSize};
	</select>

	<!-- 有改动，添加count -->
	<select id="getDevieInfoSize" parameterType="String" resultType = "Integer">
		select count(a.DDI_No)
		from t_device_device_info a left join netfiance_db.t_shop_shop_info b
		on a.DDI_SPUid = b.SHOP_Uid
		LEFT JOIN netfiance_db.t_shop_agent_list f
		ON b.SHOP_AGUid = f.AGNT_Uid
		LEFT JOIN netfiance_db.t_shop_agent_top g
		ON f.AGNT_ATUid = g.ATOP_Uid
		left join study.t_device_sub_info c
		on a.DDI_No = c.DDI_No
		left join study.t_shop_sub_info d
		on a.DDI_SPUid = d.SHOP_Uid
		left join (select DICT_Value,DICT_Name from netfiance_db.t_sys_dictionary_info where DICT_Field = 'shop_class' ) t
		on t.DICT_Value = b.SHOP_Class
	</select>

	<!-- 添加where查询条件。添加LIMIT 1控制只能显示一条数据 -->
	<select id="getDeviceInfo" parameterType="String" resultType = "java.util.HashMap">
		select a.DDI_No 机器编号,a.SHOP_No 网点编号,a.DSI_Try 启用时间,c.SHOP_Address 设备位置,b.DDI_Type 设备类型,a.DSI_Mobilecard 机器物联网卡
		from study.t_device_sub_info a left join t_device_device_info b
		on a.DDI_No = b.DDI_No
		left join netfiance_db.t_shop_shop_info c
		on a.SHOP_No = c.SHOP_No
		LEFT JOIN netfiance_db.t_shop_agent_list f
		ON c.SHOP_AGUid = f.AGNT_Uid
		LEFT JOIN netfiance_db.t_shop_agent_top g
		ON f.AGNT_ATUid = g.ATOP_Uid
		left join study.t_shop_sub_info d
		on c.SHOP_Uid = d.SHOP_Uid
		left join (select DICT_Value,DICT_Name from netfiance_db.t_sys_dictionary_info where DICT_Field = 'shop_class' ) t
		on t.DICT_Value = c.SHOP_Class
		#where a.DDI_No = '{{设备编码}}'
		#and g.ATOP_Title = '{{ 渠道名称 }}'
		#and b.DDI_Type = '{{ 设备类型 }}'
		#and a.SHOP_No = '{{ 网点编号 }}'
		#and date(a.DSI_Try) >='{{ 起始时间 }}' and date(a.DSI_Try) &lt;='{{ 截止时间 }}'
		#and t.DICT_Name = '{{ 网点类型 }}'
		#and d.SHOP_Area = '{{ 所属地区 }}'

		where a.SHOP_No = #{shopNo} LIMIT 1
	</select>

	<!-- 添加where查询条件。添加LIMIT 1控制只能显示一条数据 -->
	<select id="getShopInfo" parameterType="String" resultType = "java.util.HashMap">
		select a.SHOP_No 网点编号,a.SHOP_Title 网点名称,a.SHOP_Address 详细地址,c.SHOP_Area 所属区域,a.SHOP_Position GIS位置,t.DICT_Name 门店类型,c.SHOP_Traffic 门店每日人流量,c.SHOP_Consume 人均消费,c.SHOP_Distance 距公司距离,c.SHOP_ShoppingCenter 所属商圈,c.SHOP_OpenTime 网点开门时间,c.SHOP_CloseTime 网点关门时间,c.SHOP_AreaManager 所属区域经理,c.SHOP_Start 开始运营时间,c.SHOP_Withdraw 撤店时间
		from  netfiance_db.t_shop_shop_info a
		left join study.t_shop_sub_info c
		on a.SHOP_Uid = c.SHOP_Uid
		LEFT JOIN netfiance_db.t_shop_agent_list f
		ON a.SHOP_AGUid = f.AGNT_Uid
		LEFT JOIN netfiance_db.t_shop_agent_top g
		ON f.AGNT_ATUid = g.ATOP_Uid
		left join t_device_device_info d
		on d.DDI_SPUid = a.SHOP_Uid
		left join (select DICT_Value,DICT_Name from netfiance_db.t_sys_dictionary_info where DICT_Field = 'shop_class' ) t
		on t.DICT_Value = a.SHOP_Class
		#where SHOP_No = '{{门店编码}}'
		#and g.ATOP_Title = '{{ 渠道名称 }}'
		#and d.DDI_Type = '{{ 设备类型 }}'
		#and a.SHOP_No = '{{ 网点编号 }}'
		#and date(a.CreateDate) >='{{ 起始时间 }}' and date(a.CreateDate) &lt;='{{ 截止时间 }}'
		#and t.DICT_Name = '{{ 网点类型 }}'
		#and c.SHOP_Area  = '{{ 所属地区 }}'

	</select>



	
	
</mapper>
