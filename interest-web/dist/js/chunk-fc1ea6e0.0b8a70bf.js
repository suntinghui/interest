(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-fc1ea6e0"],{"2ea6":function(t,e,a){"use strict";var i=a("497d"),s=a.n(i);s.a},"497d":function(t,e,a){},c046:function(t,e,a){t.exports=a.p+"img/logo.5b71fac1.jpg"},cc49:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"mobild-layout"},[i("Layout",[i("Header",{staticStyle:{position:"fixed",width:"100%",background:"#fff",padding:"0 0","z-index":"1000","line-height":"0"}},[i("div",{staticStyle:{width:"95%",margin:"0 auto"}},[i("div",{staticClass:"layout-logo"},[i("a",{on:{click:function(e){return t.backHome()}}},[i("img",{staticStyle:{width:"50px",height:"50px"},attrs:{src:a("c046"),align:"absmiddle"}})])]),t.loginFlag?i("Dropdown",{staticClass:"layout-nav",attrs:{trigger:"click"},on:{"on-click":function(e){t.dropdownClick(e)}}},[i("div",{staticClass:"avatar-badge-wrapper",attrs:{type:"success"}},[i("img",{staticStyle:{width:"40px",height:"40px","margin-top":"12px","border-radius":"100%"},attrs:{src:t.user.headimg}}),t.unreadMsgCount>0?i("span",{staticClass:"msg-num"},[t._v(t._s(t.unreadMsgCount))]):t._e()]),i("DropdownMenu",{staticClass:"dropdown-menu",attrs:{slot:"list"},slot:"list"},[i("DropdownItem",{attrs:{name:"name"}},[i("Icon",{attrs:{type:"ios-person"}}),t._v("\n                           \t"+t._s(t.user.name)+"\n                        ")],1),i("DropdownItem",{attrs:{name:"email",divided:""}},[i("Icon",{attrs:{type:"ios-mail"}}),t._v("\n                            邮件\n                        ")],1),i("DropdownItem",{attrs:{name:"messages",divided:""}},[i("Icon",{attrs:{type:"md-chatboxes"}}),t._v("\n                            消息\n                        ")],1),i("DropdownItem",{attrs:{name:"loginOut",divided:""}},[i("Icon",{attrs:{type:"md-log-out"}}),t._v("\n                        \t退出\n                        ")],1)],1)],1):t._e(),t.loginFlag?t._e():i("div",{staticClass:"layout-nav",staticStyle:{"margin-top":"14px"}},[i("Button",{attrs:{shape:"circle"},on:{click:function(e){return t.toLogin()}}},[i("span",[t._v("登录")])])],1)],1)]),i("Content",{style:{margin:"80px 0 0 0",background:"#fff"}},[i("router-view")],1),i("Footer",{staticClass:"layout-footer-center"},[i("div",[i("a",{attrs:{href:"https://github.com/smallsnail-wh",target:"_blank"}},[i("Icon",{staticStyle:{color:"rebeccapurple"},attrs:{size:"40",type:"logo-github"}})],1)]),i("p",[t._v("2018-2020 © smallsail-wh")])])],1),i("Modal",{attrs:{"mask-closable":!1,visible:t.emailModal,loading:t.loading,title:"联系管理员"},on:{"update:visible":function(e){t.emailModal=e},"on-ok":function(e){return t.emailOk("email")},"on-cancel":function(e){return t.cancel()}},model:{value:t.emailModal,callback:function(e){t.emailModal=e},expression:"emailModal"}},[i("Form",{ref:"email",attrs:{rules:t.emailRule,model:t.email,"label-width":80}},[i("FormItem",{attrs:{label:"标题",prop:"title"}},[i("Input",{attrs:{placeholder:"请输入标题"},model:{value:t.email.title,callback:function(e){t.$set(t.email,"title",e)},expression:"email.title"}})],1),i("FormItem",{attrs:{label:"email",prop:"email"}},[i("Input",{attrs:{placeholder:"请输入email"},model:{value:t.email.email,callback:function(e){t.$set(t.email,"email",e)},expression:"email.email"}})],1),i("FormItem",{attrs:{label:"姓名",prop:"name"}},[i("Input",{attrs:{placeholder:"请输入姓名"},model:{value:t.email.name,callback:function(e){t.$set(t.email,"name",e)},expression:"email.name"}})],1),i("FormItem",{attrs:{label:"内容",prop:"content"}},[i("Input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:5},placeholder:"Enter something..."},model:{value:t.email.content,callback:function(e){t.$set(t.email,"content",e)},expression:"email.content"}})],1)],1)],1)],1)},s=[],o={data:function(){return{loginFlag:!1,consoleFlag:!1,loading:!0,searchValue:"",unreadMsgCount:0,emailModal:!1,email:{title:"",email:"",name:"",content:""},user:{loginName:"",email:"",headimg:"",name:""},emailRule:{title:[{type:"string",required:!0,message:"请输入密码",trigger:"blur"}],email:[{required:!0,message:"输入邮箱",trigger:"blur"},{type:"email",message:"输入正确的邮箱格式",trigger:"blur"}],passwordAgain:[{type:"string",required:!0,message:"请输入再次输入密码",trigger:"blur"}],name:[{type:"string",required:!0,message:"请输入姓名",trigger:"blur"}],content:[{required:!0,message:"请输入内容",trigger:"blur"}]}}},mounted:function(){this.$store.getters._isMobile||this.$router.replace("/");var t=this.$route.query.code,e=this.$route.query.state;this.login(t,e)},methods:{dropdownClick:function(t){"email"==t?this.emailModal=!0:"loginOut"==t?this.$store.dispatch("users/loginOUt",{router:this.$router}):"messages"==t&&this.$router.push({path:"/mobile/messages"})},toLogin:function(){this.$router.push("/mlogin")},userGet:function(){var t=this;this.axios({method:"get",url:"/public/user"}).then(function(t){return null!=t.data.data&&""!=t.data.data?(this.loginFlag=!0,this.userSet(t.data.data),1==t.data.data.usertype&&(this.consoleFlag=!0),this.axios({method:"get",url:"/msgrecords/unreadnum"})):Promise.resolve(0)}.bind(this)).then((function(e){t.unreadMsgCount=0===e?e:e.data.data})).catch(function(t){this.$Message.error("无权限")}.bind(this))},userSet:function(t){this.user.loginName=t.loginName,this.user.email=t.email,this.user.headimg=t.headimg,this.user.name=t.name},search:function(){null!=this.searchValue&&""!=this.searchValue&&this.$router.push("/page/home/"+this.searchValue)},menuSelect:function(t){1==t||(2==t?this.emailModal=!0:3==t?this.$store.dispatch("users/loginOUt",{router:this.$router}):4==t?this.$router.push("/base"):5==t&&this.$router.push("/login"))},backHome:function(){this.$router.push("/page/home")},cancel:function(){},emailOk:function(t){var e=this;this.$refs[t].validate((function(t){t?(e.axios({method:"post",url:"/email",data:e.email}).then(function(t){this.$Message.info("发送成功")}.bind(e)).catch((function(t){alert(t)})),e.emailModal=!1):(e.$Message.error("表单验证失败!"),setTimeout((function(){e.loading=!1,e.$nextTick((function(){e.loading=!0}))}),1e3))}))},login:function(t,e){var a=this;null!=t&&""!=t&&null!=e&&""!=e?(this.$Spin.show({render:function(t){return t("div",[t("Icon",{style:{animation:"ani-demo-spin 1s linear infinite"},props:{type:"load-c",size:18}}),t("div","正在登录，请等待...")])}}),setTimeout((function(){a.$Spin.hide()}),1e4),"github"==e?this.githubLogin(t):"qq"==e?this.qqLogin(t):(this.$router.push({path:"/"}),location.reload())):this.userGet()},githubLogin:function(t){this.axios({method:"post",url:"/authentication/github",params:{code:t},auth:{username:"client",password:"secret"}}).then(function(t){localStorage.setItem("currentUser_token",t.data.access_token),localStorage.setItem("currentUser_refresh_token",t.data.refresh_token),this.axios.defaults.headers.common["Authorization"]="bearer "+localStorage.getItem("currentUser_token"),this.$router.push({path:"/"}),location.reload()}.bind(this)).catch(function(t){this.$Message.error("登陆失败")}.bind(this))},qqLogin:function(t){this.axios({method:"post",url:"/authentication/qq",params:{code:t},auth:{username:"client",password:"secret"}}).then(function(t){localStorage.setItem("currentUser_token",t.data.access_token),localStorage.setItem("currentUser_refresh_token",t.data.refresh_token),this.axios.defaults.headers.common["Authorization"]="bearer "+localStorage.getItem("currentUser_token"),this.$router.push({path:"/"}),location.reload()}.bind(this)).catch(function(t){this.$Message.error("登陆失败")}.bind(this))},toMessages:function(){this.$router.push({path:"/page/messages"})}}},n=o,r=(a("2ea6"),a("2877")),l=Object(r["a"])(n,i,s,!1,null,"660312da",null);e["default"]=l.exports}}]);
//# sourceMappingURL=chunk-fc1ea6e0.0b8a70bf.js.map