{"remainingRequest":"E:\\workspace\\javaEE\\interest\\interest-web\\node_modules\\babel-loader\\lib\\index.js!E:\\workspace\\javaEE\\interest\\interest-web\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!E:\\workspace\\javaEE\\interest\\interest-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\workspace\\javaEE\\interest\\interest-web\\src\\views\\rainbow\\jsc\\wdjyxx.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\workspace\\javaEE\\interest\\interest-web\\src\\views\\rainbow\\jsc\\wdjyxx.vue","mtime":1579495675831},{"path":"E:\\workspace\\javaEE\\interest\\interest-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\workspace\\javaEE\\interest\\interest-web\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"E:\\workspace\\javaEE\\interest\\interest-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\workspace\\javaEE\\interest\\interest-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\nimport AMap from 'AMap';\nimport util from '../../../util.js';\nimport data from '../../../data.js'; // for axios add finally\n\nimport promiseFinally from 'promise.prototype.finally';\npromiseFinally.shim();\nimport deviceInfo from '../../component/deviceInfo';\n\nvar _this;\n\nexport default {\n  name: '设备交易信息',\n  data: function data() {\n    return {\n      map: null,\n      data: [],\n      showSpin: false,\n      startDate: util.lastMonth(new Date()),\n      endDate: util.dateFormat(new Date()),\n      showDetailModel: false,\n      // 控制是否显示详情\n      detailInfo: {},\n      // 某条数据下的所有的详情信息\n      transferInfo: {},\n      tabCheck: \"name1\",\n      detailTitle: '加载中...'\n    };\n  },\n  components: {\n    'deviceInfoModal': deviceInfo\n  },\n  mounted: function mounted() {\n    this.init();\n    this.queryData();\n  },\n  methods: {\n    init: function init() {\n      _this = this;\n      this.map = new AMap.Map('container', {\n        center: [116.397428, 39.90923],\n        resizeEnable: true,\n        zoom: 11,\n        features: ['bg', 'road', 'building']\n      });\n      this.map.plugin(['AMap.ToolBar', 'AMap.Scale', 'AMap.OverView'], function () {\n        _this.map.addControl(new AMap.ToolBar());\n\n        _this.map.addControl(new AMap.Scale()); // 鹰眼\n\n\n        var overView = new AMap.OverView({\n          visible: true\n        });\n        overView.open();\n\n        _this.map.addControl(overView);\n      });\n    },\n\n    /*得到详情数据*/\n    showDetailInfo: function showDetailInfo(ddiNo, shopNo) {\n      this.showDetailModel = false;\n      this.tabCheck = \"name1\"; // 默认刚打开时保证总是显示第一个tab\n\n      this.detailInfo = []; // 置空详情数据，否则打开时仍然是上次的数据\n\n      this.transferInfo = [];\n      this.queryDetailInfo(ddiNo, shopNo);\n      this.queryTransferInfo(ddiNo, shopNo);\n    },\n    queryDetailInfo: function queryDetailInfo(ddiNo, shopNo) {\n      this.detailTitle = '加载中...';\n      this.showSpin = true;\n      this.axios({\n        method: \"get\",\n        url: \"/rainbow/jqsxxx_detail\",\n        params: {\n          filterMap: {\n            ddiNo: ddiNo,\n            shopValue: shopNo,\n            startDate: this.startDate,\n            endDate: this.endDate\n          }\n        }\n      }).then(function (response) {\n        console.log(JSON.stringify(response));\n        this.detailTitle = '详情信息';\n        this.detailInfo = response.data.data;\n        this.showDetailModel = true;\n      }.bind(this)).catch(function (error) {\n        //alert(error);\n        this.showSpin = false;\n      }).finally(function () {}.bind(this));\n    },\n    queryTransferInfo: function queryTransferInfo(ddiNo, shopNo) {\n      this.showSpin = true;\n      this.axios({\n        method: \"get\",\n        url: \"/rainbow/jqsxxx_transfer_list\",\n        params: {\n          filterMap: {\n            ddiNo: ddiNo,\n            shopValue: shopNo,\n            startDate: this.startDate,\n            endDate: this.endDate\n          }\n        }\n      }).then(function (response) {\n        console.log(JSON.stringify(response));\n        this.transferInfo = response.data.data;\n      }.bind(this)).catch(function (error) {\n        //alert(error);\n        this.showSpin = false;\n      }).finally(function () {}.bind(this));\n    },\n    closeSpin: function closeSpin() {\n      console.log(\"==++++++++++++++++++++============================\");\n      this.showSpin = false;\n    },\n    queryData: function queryData() {\n      this.showSpin = true;\n      this.axios({\n        method: \"get\",\n        url: \"/rainbow/wdjyxx\",\n        timeout: 1000 * 60 * 2,\n        params: {\n          filterMap: {\n            startDate: this.startDate,\n            endDate: this.endDate\n          }\n        }\n      }).then(function (response) {\n        console.log(JSON.stringify(response));\n        var tempData = response.data.data;\n        this.data = [];\n\n        for (var i = 0; i < tempData.length; i++) {\n          var item = tempData[i];\n          var ll = item.SHOP_Position.split(',');\n          if (ll.length != 2) continue;\n          this.data.push({\n            lng: parseFloat(ll[0]),\n            lat: parseFloat(ll[1]),\n            count: item['交易张数总计'],\n            ddiNo: item['DDI_No'],\n            shopNo: item['SHOP_No']\n          });\n        }\n\n        this.loadData();\n      }.bind(this)).catch(function (error) {//alert(error);\n      }).finally(function () {\n        this.showSpin = false;\n      }.bind(this));\n    },\n    loadData: function loadData() {\n      console.log(this.data);\n      var heatmap;\n      AMap.plugin([\"AMap.Heatmap\"], function () {\n        //初始化heatmap对象\n        heatmap = new AMap.Heatmap(_this.map, {\n          radius: 25,\n          //给定半径\n          opacity: [0, 0.8]\n          /*,\n          gradient:{\n              0.5: 'blue',\n              0.65: 'rgb(117,211,248)',\n              0.7: 'rgb(0, 255, 0)',\n              0.9: '#ffea00',\n              1.0: 'red'\n          }\n           */\n\n        }); //设置数据集：该数据为北京部分“公园”数据\n\n        heatmap.setDataSet({\n          data: _this.data,\n          max: 100\n        });\n      });\n      var cluster,\n          markers = [];\n      AMap.plugin(['AMap.MarkerClusterer'], function () {\n        for (var i = 0; i < _this.data.length; i += 1) {\n          var item = _this.data[i];\n          var marker = new AMap.Marker({\n            position: [item['lng'], item['lat']],\n            content: '<div style=\"background-color: hsla(180, 100%, 50%, 0.7); height: 24px; width: 24px; border: 1px solid hsl(180, 100%, 40%); border-radius: 12px; box-shadow: hsl(180, 100%, 50%) 0px 0px 1px;\"></div>',\n            offset: new AMap.Pixel(-15, -15),\n            clickable: true\n          });\n          AMap.event.addListener(marker, 'click', function () {\n            _this.showDetailInfo(item['ddiNo'], item['shopNo']);\n          });\n          markers.push(marker);\n        }\n\n        var count = markers.length;\n\n        var _renderClusterMarker = function _renderClusterMarker(context) {\n          var factor = Math.pow(context.count / count, 1 / 18);\n          var div = document.createElement('div');\n          var Hue = 180 - factor * 180;\n          var bgColor = 'hsla(' + Hue + ',100%,50%,0.7)';\n          var fontColor = 'hsla(' + Hue + ',100%,20%,1)';\n          var borderColor = 'hsla(' + Hue + ',100%,40%,1)';\n          var shadowColor = 'hsla(' + Hue + ',100%,50%,1)';\n          div.style.backgroundColor = bgColor;\n          var size = Math.round(30 + Math.pow(context.count / count, 1 / 5) * 20);\n          div.style.width = div.style.height = size + 'px';\n          div.style.border = 'solid 1px ' + borderColor;\n          div.style.borderRadius = size / 2 + 'px';\n          div.style.boxShadow = '0 0 1px ' + shadowColor;\n          div.innerHTML = context.count;\n          div.style.lineHeight = size + 'px';\n          div.style.color = fontColor;\n          div.style.fontSize = '14px';\n          div.style.textAlign = 'center';\n          context.marker.setOffset(new AMap.Pixel(-size / 2, -size / 2));\n          context.marker.setContent(div);\n        };\n\n        if (cluster) {\n          cluster.setMap(null);\n        }\n\n        cluster = new AMap.MarkerClusterer(_this.map, markers, {\n          gridSize: 80,\n          renderClusterMarker: _renderClusterMarker\n        });\n      });\n    }\n  }\n};",{"version":3,"sources":["wdjyxx.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\r\n\t<div>\r\n\t\t<div style=\"height:630px\" id=\"container\" tabindex=\"0\"></div>\r\n\t\t<Spin size=\"large\" fix v-if=\"showSpin\"></Spin>\r\n\t\t<deviceInfoModal :showModal=\"showDetailModel\" :detailInfo='detailInfo' :transferInfo='transferInfo' :detailTitle=\"detailTitle\" :tabCheck=\"tabCheck\" @closeSpin=\"closeSpin\"></deviceInfoModal>\r\n\t</div>\r\n</template>\r\n\r\n<script>\r\n\timport AMap from 'AMap'\r\n\timport util from '../../../util.js'\r\n\timport data from '../../../data.js'\r\n\t// for axios add finally\r\n\timport promiseFinally from 'promise.prototype.finally';\r\n\tpromiseFinally.shim();\r\n\t\r\n\timport deviceInfo from '../../component/deviceInfo'\r\n\r\n\tvar _this;\r\n\r\n\texport default {\r\n\r\n\t\tname: '设备交易信息',\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tmap: null,\r\n\t\t\t\tdata: [],\r\n\t\t\t\t\r\n\t\t\t\tshowSpin: false,\r\n\t\t\t\t\r\n\t\t\t\tstartDate: util.lastMonth(new Date()),\r\n\t\t\t\tendDate: util.dateFormat(new Date()),\r\n\t\t\t\t\r\n\t\t\t\tshowDetailModel: false, // 控制是否显示详情\r\n\t\t\t\tdetailInfo: {}, // 某条数据下的所有的详情信息\r\n\t\t\t\ttransferInfo: {},\r\n\t\t\t\ttabCheck: \"name1\",\r\n\t\t\t\tdetailTitle: '加载中...',\r\n\t\t\t}\r\n\t\t},\r\n\t\tcomponents: {\r\n\t\t\t'deviceInfoModal': deviceInfo\r\n\t\t},\r\n\t\tmounted() {\r\n\t\t\tthis.init()\r\n\t\t\tthis.queryData()\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\tinit: function() {\r\n\t\t\t\t_this = this;\r\n\r\n\t\t\t\tthis.map = new AMap.Map('container', {\r\n\t\t\t\t\tcenter: [116.397428, 39.90923],\r\n\t\t\t\t\tresizeEnable: true,\r\n\t\t\t\t\tzoom: 11,\r\n\t\t\t\t\tfeatures: ['bg', 'road', 'building'],\r\n\t\t\t\t})\r\n\r\n\t\t\t\tthis.map.plugin(['AMap.ToolBar', 'AMap.Scale', 'AMap.OverView'], function() {\r\n\t\t\t\t\t_this.map.addControl(new AMap.ToolBar())\r\n\t\t\t\t\t_this.map.addControl(new AMap.Scale())\r\n\r\n\t\t\t\t\t// 鹰眼\r\n\t\t\t\t\tvar overView = new AMap.OverView({\r\n\t\t\t\t\t\tvisible: true\r\n\t\t\t\t\t});\r\n\t\t\t\t\toverView.open();\r\n\t\t\t\t\t_this.map.addControl(overView)\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t/*得到详情数据*/\r\n\t\t\tshowDetailInfo(ddiNo, shopNo) {\r\n\t\t\t\t\r\n\t\t\t\tthis.showDetailModel = false;\r\n\t\t\t\t\r\n\t\t\t\tthis.tabCheck = \"name1\"; // 默认刚打开时保证总是显示第一个tab\r\n\t\t\t\r\n\t\t\t\tthis.detailInfo = []; // 置空详情数据，否则打开时仍然是上次的数据\r\n\t\t\t\r\n\t\t\t\tthis.transferInfo = [];\r\n\t\t\t\t\r\n\t\t\t\tthis.queryDetailInfo(ddiNo, shopNo);\r\n\t\t\t\r\n\t\t\t\tthis.queryTransferInfo(ddiNo, shopNo);\r\n\t\t\t\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\tqueryDetailInfo(ddiNo, shopNo) {\r\n\t\t\t\tthis.detailTitle = '加载中...';\r\n\t\t\t\r\n\t\t\t\tthis.showSpin = true;\r\n\t\t\t\r\n\t\t\t\tthis.axios({\r\n\t\t\t\t\t\tmethod: \"get\",\r\n\t\t\t\t\t\turl: \"/rainbow/jqsxxx_detail\",\r\n\t\t\t\t\t\tparams: {\r\n\t\t\t\t\t\t\tfilterMap: {\r\n\t\t\t\t\t\t\t\tddiNo: ddiNo,\r\n\t\t\t\t\t\t\t\tshopValue: shopNo,\r\n\t\t\t\t\t\t\t\tstartDate: this.startDate,\r\n\t\t\t\t\t\t\t\tendDate: this.endDate\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.then(\r\n\t\t\t\t\t\tfunction(response) {\r\n\t\t\t\t\t\t\tconsole.log(JSON.stringify(response))\r\n\t\t\t\r\n\t\t\t\t\t\t\tthis.detailTitle = '详情信息';\r\n\t\t\t\r\n\t\t\t\t\t\t\tthis.detailInfo = response.data.data;\r\n\t\t\t\r\n\t\t\t\t\t\t\tthis.showDetailModel = true;\r\n\t\t\t\r\n\t\t\t\t\t\t}.bind(this)\r\n\t\t\t\t\t)\r\n\t\t\t\t\t.catch(function(error) {\r\n\t\t\t\t\t\t//alert(error);\r\n\t\t\t\t\t\tthis.showSpin = false;\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.finally(function() {\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t}.bind(this));\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\tqueryTransferInfo(ddiNo, shopNo) {\r\n\t\t\t\tthis.showSpin = true;\r\n\t\t\t\r\n\t\t\t\tthis.axios({\r\n\t\t\t\t\t\tmethod: \"get\",\r\n\t\t\t\t\t\turl: \"/rainbow/jqsxxx_transfer_list\",\r\n\t\t\t\t\t\tparams: {\r\n\t\t\t\t\t\t\tfilterMap: {\r\n\t\t\t\t\t\t\t\tddiNo: ddiNo,\r\n\t\t\t\t\t\t\t\tshopValue: shopNo,\r\n\t\t\t\t\t\t\t\tstartDate: this.startDate,\r\n\t\t\t\t\t\t\t\tendDate: this.endDate\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.then(\r\n\t\t\t\t\t\tfunction(response) {\r\n\t\t\t\t\t\t\tconsole.log(JSON.stringify(response))\r\n\t\t\t\r\n\t\t\t\t\t\t\tthis.transferInfo = response.data.data;\r\n\t\t\t\r\n\t\t\t\t\t\t}.bind(this)\r\n\t\t\t\t\t)\r\n\t\t\t\t\t.catch(function(error) {\r\n\t\t\t\t\t\t//alert(error);\r\n\t\t\t\t\t\tthis.showSpin = false;\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.finally(function() {\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t}.bind(this));\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\tcloseSpin() {\r\n\t\t\t\tconsole.log(\"==++++++++++++++++++++============================\")\r\n\t\t\t\tthis.showSpin = false;\r\n\t\t\t}, \r\n\r\n\t\t\tqueryData() {\r\n\t\t\t\tthis.showSpin = true;\r\n\r\n\t\t\t\tthis.axios({\r\n\t\t\t\t\t\tmethod: \"get\",\r\n\t\t\t\t\t\turl: \"/rainbow/wdjyxx\",\r\n\t\t\t\t\t\ttimeout: 1000 * 60 * 2,\r\n\t\t\t\t\t\tparams: {\r\n\t\t\t\t\t\t\tfilterMap: {\r\n\t\t\t\t\t\t\t\tstartDate: this.startDate,\r\n\t\t\t\t\t\t\t\tendDate: this.endDate,\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.then(\r\n\t\t\t\t\t\tfunction(response) {\r\n\t\t\t\t\t\t\tconsole.log(JSON.stringify(response))\r\n\r\n\t\t\t\t\t\t\tvar tempData = response.data.data;\r\n\t\t\t\t\t\t\tthis.data = [];\r\n\r\n\t\t\t\t\t\t\tfor (var i = 0; i < tempData.length; i++) {\r\n\t\t\t\t\t\t\t\tvar item = tempData[i];\r\n\t\t\t\t\t\t\t\tvar ll = item.SHOP_Position.split(',');\r\n\t\t\t\t\t\t\t\tif (ll.length != 2)\r\n\t\t\t\t\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\t\t\t\t\tthis.data.push({\r\n\t\t\t\t\t\t\t\t\tlng: parseFloat(ll[0]),\r\n\t\t\t\t\t\t\t\t\tlat: parseFloat(ll[1]),\r\n\t\t\t\t\t\t\t\t\tcount: item['交易张数总计'],\r\n\t\t\t\t\t\t\t\t\tddiNo: item['DDI_No'],\r\n\t\t\t\t\t\t\t\t\tshopNo: item['SHOP_No']\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tthis.loadData();\r\n\r\n\t\t\t\t\t\t}.bind(this)\r\n\t\t\t\t\t)\r\n\t\t\t\t\t.catch(function(error) {\r\n\t\t\t\t\t\t//alert(error);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.finally(function() {\r\n\t\t\t\t\t\tthis.showSpin = false;\r\n\t\t\t\t\t}.bind(this));\r\n\r\n\t\t\t},\r\n\r\n\t\t\tloadData() {\r\n\r\n\t\t\t\tconsole.log(this.data)\r\n\r\n\t\t\t\tvar heatmap;\r\n\t\t\t\tAMap.plugin([\"AMap.Heatmap\"], function() {\r\n\t\t\t\t\t//初始化heatmap对象\r\n\t\t\t\t\theatmap = new AMap.Heatmap(_this.map, {\r\n\t\t\t\t\t\tradius: 25, //给定半径\r\n\t\t\t\t\t\topacity: [0, 0.8]\r\n\t\t\t\t\t\t/*,\r\n\t\t\t\t\t\tgradient:{\r\n\t\t\t\t\t\t    0.5: 'blue',\r\n\t\t\t\t\t\t    0.65: 'rgb(117,211,248)',\r\n\t\t\t\t\t\t    0.7: 'rgb(0, 255, 0)',\r\n\t\t\t\t\t\t    0.9: '#ffea00',\r\n\t\t\t\t\t\t    1.0: 'red'\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t */\r\n\t\t\t\t\t});\r\n\t\t\t\t\t//设置数据集：该数据为北京部分“公园”数据\r\n\t\t\t\t\theatmap.setDataSet({\r\n\t\t\t\t\t\tdata: _this.data,\r\n\t\t\t\t\t\tmax: 100\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\r\n\r\n\r\n\t\t\t\tvar cluster, markers = [];\r\n\t\t\t\tAMap.plugin(['AMap.MarkerClusterer'], function() {\r\n\t\t\t\t\tfor (var i = 0; i < _this.data.length; i += 1) {\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tvar item = _this.data[i];\r\n\r\n\t\t\t\t\t\tvar marker = new AMap.Marker({\r\n\t\t\t\t\t\t\tposition: [item['lng'], item['lat']],\r\n\t\t\t\t\t\t\tcontent: '<div style=\"background-color: hsla(180, 100%, 50%, 0.7); height: 24px; width: 24px; border: 1px solid hsl(180, 100%, 40%); border-radius: 12px; box-shadow: hsl(180, 100%, 50%) 0px 0px 1px;\"></div>',\r\n\t\t\t\t\t\t\toffset: new AMap.Pixel(-15, -15),\r\n\t\t\t\t\t\t\tclickable: true,\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tAMap.event.addListener(marker, 'click', function() {\r\n\t\t\t\t\t\t\t_this.showDetailInfo(item['ddiNo'], item['shopNo']);\r\n\t\t\t\t\t\t})\r\n\r\n\t\t\t\t\t\tmarkers.push(marker)\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar count = markers.length;\r\n\t\t\t\t\tvar _renderClusterMarker = function(context) {\r\n\t\t\t\t\t\tvar factor = Math.pow(context.count / count, 1 / 18);\r\n\t\t\t\t\t\tvar div = document.createElement('div');\r\n\t\t\t\t\t\tvar Hue = 180 - factor * 180;\r\n\t\t\t\t\t\tvar bgColor = 'hsla(' + Hue + ',100%,50%,0.7)';\r\n\t\t\t\t\t\tvar fontColor = 'hsla(' + Hue + ',100%,20%,1)';\r\n\t\t\t\t\t\tvar borderColor = 'hsla(' + Hue + ',100%,40%,1)';\r\n\t\t\t\t\t\tvar shadowColor = 'hsla(' + Hue + ',100%,50%,1)';\r\n\t\t\t\t\t\tdiv.style.backgroundColor = bgColor;\r\n\t\t\t\t\t\tvar size = Math.round(30 + Math.pow(context.count / count, 1 / 5) * 20);\r\n\t\t\t\t\t\tdiv.style.width = div.style.height = size + 'px';\r\n\t\t\t\t\t\tdiv.style.border = 'solid 1px ' + borderColor;\r\n\t\t\t\t\t\tdiv.style.borderRadius = size / 2 + 'px';\r\n\t\t\t\t\t\tdiv.style.boxShadow = '0 0 1px ' + shadowColor;\r\n\t\t\t\t\t\tdiv.innerHTML = context.count;\r\n\t\t\t\t\t\tdiv.style.lineHeight = size + 'px';\r\n\t\t\t\t\t\tdiv.style.color = fontColor;\r\n\t\t\t\t\t\tdiv.style.fontSize = '14px';\r\n\t\t\t\t\t\tdiv.style.textAlign = 'center';\r\n\t\t\t\t\t\tcontext.marker.setOffset(new AMap.Pixel(-size / 2, -size / 2));\r\n\t\t\t\t\t\tcontext.marker.setContent(div)\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tif (cluster) {\r\n\t\t\t\t\t\tcluster.setMap(null);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tcluster = new AMap.MarkerClusterer(_this.map, markers, {\r\n\t\t\t\t\t\tgridSize: 80,\r\n\t\t\t\t\t\trenderClusterMarker: _renderClusterMarker\r\n\t\t\t\t\t});\r\n\t\t\t\t})\r\n\t\t\t},\r\n\r\n\t\t}\r\n\t}\r\n</script>\n"],"sourceRoot":"src/views/rainbow/jsc"}]}