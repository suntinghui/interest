{"remainingRequest":"E:\\workspace\\javaEE\\interest\\interest-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\workspace\\javaEE\\interest\\interest-web\\src\\views\\rainbow\\jsc\\wdjyxx.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\workspace\\javaEE\\interest\\interest-web\\src\\views\\rainbow\\jsc\\wdjyxx.vue","mtime":1579495675831},{"path":"E:\\workspace\\javaEE\\interest\\interest-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\workspace\\javaEE\\interest\\interest-web\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"E:\\workspace\\javaEE\\interest\\interest-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\workspace\\javaEE\\interest\\interest-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n\nimport AMap from 'AMap'\nimport util from '../../../util.js'\nimport data from '../../../data.js'\n// for axios add finally\nimport promiseFinally from 'promise.prototype.finally';\npromiseFinally.shim();\n\nimport deviceInfo from '../../component/deviceInfo'\n\nvar _this;\n\nexport default {\n\n\tname: '设备交易信息',\n\tdata() {\n\t\treturn {\n\t\t\tmap: null,\n\t\t\tdata: [],\n\t\t\t\n\t\t\tshowSpin: false,\n\t\t\t\n\t\t\tstartDate: util.lastMonth(new Date()),\n\t\t\tendDate: util.dateFormat(new Date()),\n\t\t\t\n\t\t\tshowDetailModel: false, // 控制是否显示详情\n\t\t\tdetailInfo: {}, // 某条数据下的所有的详情信息\n\t\t\ttransferInfo: {},\n\t\t\ttabCheck: \"name1\",\n\t\t\tdetailTitle: '加载中...',\n\t\t}\n\t},\n\tcomponents: {\n\t\t'deviceInfoModal': deviceInfo\n\t},\n\tmounted() {\n\t\tthis.init()\n\t\tthis.queryData()\n\t},\n\tmethods: {\n\t\tinit: function() {\n\t\t\t_this = this;\n\n\t\t\tthis.map = new AMap.Map('container', {\n\t\t\t\tcenter: [116.397428, 39.90923],\n\t\t\t\tresizeEnable: true,\n\t\t\t\tzoom: 11,\n\t\t\t\tfeatures: ['bg', 'road', 'building'],\n\t\t\t})\n\n\t\t\tthis.map.plugin(['AMap.ToolBar', 'AMap.Scale', 'AMap.OverView'], function() {\n\t\t\t\t_this.map.addControl(new AMap.ToolBar())\n\t\t\t\t_this.map.addControl(new AMap.Scale())\n\n\t\t\t\t// 鹰眼\n\t\t\t\tvar overView = new AMap.OverView({\n\t\t\t\t\tvisible: true\n\t\t\t\t});\n\t\t\t\toverView.open();\n\t\t\t\t_this.map.addControl(overView)\n\t\t\t})\n\t\t},\n\t\t\n\t\t/*得到详情数据*/\n\t\tshowDetailInfo(ddiNo, shopNo) {\n\t\t\t\n\t\t\tthis.showDetailModel = false;\n\t\t\t\n\t\t\tthis.tabCheck = \"name1\"; // 默认刚打开时保证总是显示第一个tab\n\t\t\n\t\t\tthis.detailInfo = []; // 置空详情数据，否则打开时仍然是上次的数据\n\t\t\n\t\t\tthis.transferInfo = [];\n\t\t\t\n\t\t\tthis.queryDetailInfo(ddiNo, shopNo);\n\t\t\n\t\t\tthis.queryTransferInfo(ddiNo, shopNo);\n\t\t\n\t\t},\n\t\t\n\t\tqueryDetailInfo(ddiNo, shopNo) {\n\t\t\tthis.detailTitle = '加载中...';\n\t\t\n\t\t\tthis.showSpin = true;\n\t\t\n\t\t\tthis.axios({\n\t\t\t\t\tmethod: \"get\",\n\t\t\t\t\turl: \"/rainbow/jqsxxx_detail\",\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tfilterMap: {\n\t\t\t\t\t\t\tddiNo: ddiNo,\n\t\t\t\t\t\t\tshopValue: shopNo,\n\t\t\t\t\t\t\tstartDate: this.startDate,\n\t\t\t\t\t\t\tendDate: this.endDate\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.then(\n\t\t\t\t\tfunction(response) {\n\t\t\t\t\t\tconsole.log(JSON.stringify(response))\n\t\t\n\t\t\t\t\t\tthis.detailTitle = '详情信息';\n\t\t\n\t\t\t\t\t\tthis.detailInfo = response.data.data;\n\t\t\n\t\t\t\t\t\tthis.showDetailModel = true;\n\t\t\n\t\t\t\t\t}.bind(this)\n\t\t\t\t)\n\t\t\t\t.catch(function(error) {\n\t\t\t\t\t//alert(error);\n\t\t\t\t\tthis.showSpin = false;\n\t\t\t\t})\n\t\t\t\t.finally(function() {\n\t\t\t\t\t\n\t\t\t\t}.bind(this));\n\t\t},\n\t\t\n\t\tqueryTransferInfo(ddiNo, shopNo) {\n\t\t\tthis.showSpin = true;\n\t\t\n\t\t\tthis.axios({\n\t\t\t\t\tmethod: \"get\",\n\t\t\t\t\turl: \"/rainbow/jqsxxx_transfer_list\",\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tfilterMap: {\n\t\t\t\t\t\t\tddiNo: ddiNo,\n\t\t\t\t\t\t\tshopValue: shopNo,\n\t\t\t\t\t\t\tstartDate: this.startDate,\n\t\t\t\t\t\t\tendDate: this.endDate\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.then(\n\t\t\t\t\tfunction(response) {\n\t\t\t\t\t\tconsole.log(JSON.stringify(response))\n\t\t\n\t\t\t\t\t\tthis.transferInfo = response.data.data;\n\t\t\n\t\t\t\t\t}.bind(this)\n\t\t\t\t)\n\t\t\t\t.catch(function(error) {\n\t\t\t\t\t//alert(error);\n\t\t\t\t\tthis.showSpin = false;\n\t\t\t\t})\n\t\t\t\t.finally(function() {\n\t\t\t\t\t\n\t\t\t\t}.bind(this));\n\t\t},\n\t\t\n\t\tcloseSpin() {\n\t\t\tconsole.log(\"==++++++++++++++++++++============================\")\n\t\t\tthis.showSpin = false;\n\t\t}, \n\n\t\tqueryData() {\n\t\t\tthis.showSpin = true;\n\n\t\t\tthis.axios({\n\t\t\t\t\tmethod: \"get\",\n\t\t\t\t\turl: \"/rainbow/wdjyxx\",\n\t\t\t\t\ttimeout: 1000 * 60 * 2,\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tfilterMap: {\n\t\t\t\t\t\t\tstartDate: this.startDate,\n\t\t\t\t\t\t\tendDate: this.endDate,\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.then(\n\t\t\t\t\tfunction(response) {\n\t\t\t\t\t\tconsole.log(JSON.stringify(response))\n\n\t\t\t\t\t\tvar tempData = response.data.data;\n\t\t\t\t\t\tthis.data = [];\n\n\t\t\t\t\t\tfor (var i = 0; i < tempData.length; i++) {\n\t\t\t\t\t\t\tvar item = tempData[i];\n\t\t\t\t\t\t\tvar ll = item.SHOP_Position.split(',');\n\t\t\t\t\t\t\tif (ll.length != 2)\n\t\t\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\t\t\tthis.data.push({\n\t\t\t\t\t\t\t\tlng: parseFloat(ll[0]),\n\t\t\t\t\t\t\t\tlat: parseFloat(ll[1]),\n\t\t\t\t\t\t\t\tcount: item['交易张数总计'],\n\t\t\t\t\t\t\t\tddiNo: item['DDI_No'],\n\t\t\t\t\t\t\t\tshopNo: item['SHOP_No']\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.loadData();\n\n\t\t\t\t\t}.bind(this)\n\t\t\t\t)\n\t\t\t\t.catch(function(error) {\n\t\t\t\t\t//alert(error);\n\t\t\t\t\t\n\t\t\t\t})\n\t\t\t\t.finally(function() {\n\t\t\t\t\tthis.showSpin = false;\n\t\t\t\t}.bind(this));\n\n\t\t},\n\n\t\tloadData() {\n\n\t\t\tconsole.log(this.data)\n\n\t\t\tvar heatmap;\n\t\t\tAMap.plugin([\"AMap.Heatmap\"], function() {\n\t\t\t\t//初始化heatmap对象\n\t\t\t\theatmap = new AMap.Heatmap(_this.map, {\n\t\t\t\t\tradius: 25, //给定半径\n\t\t\t\t\topacity: [0, 0.8]\n\t\t\t\t\t/*,\n\t\t\t\t\tgradient:{\n\t\t\t\t\t    0.5: 'blue',\n\t\t\t\t\t    0.65: 'rgb(117,211,248)',\n\t\t\t\t\t    0.7: 'rgb(0, 255, 0)',\n\t\t\t\t\t    0.9: '#ffea00',\n\t\t\t\t\t    1.0: 'red'\n\t\t\t\t\t}\n\t\t\t\t\t */\n\t\t\t\t});\n\t\t\t\t//设置数据集：该数据为北京部分“公园”数据\n\t\t\t\theatmap.setDataSet({\n\t\t\t\t\tdata: _this.data,\n\t\t\t\t\tmax: 100\n\t\t\t\t});\n\t\t\t});\n\n\n\n\t\t\tvar cluster, markers = [];\n\t\t\tAMap.plugin(['AMap.MarkerClusterer'], function() {\n\t\t\t\tfor (var i = 0; i < _this.data.length; i += 1) {\n\t\t\t\t\t\n\t\t\t\t\tvar item = _this.data[i];\n\n\t\t\t\t\tvar marker = new AMap.Marker({\n\t\t\t\t\t\tposition: [item['lng'], item['lat']],\n\t\t\t\t\t\tcontent: '<div style=\"background-color: hsla(180, 100%, 50%, 0.7); height: 24px; width: 24px; border: 1px solid hsl(180, 100%, 40%); border-radius: 12px; box-shadow: hsl(180, 100%, 50%) 0px 0px 1px;\"></div>',\n\t\t\t\t\t\toffset: new AMap.Pixel(-15, -15),\n\t\t\t\t\t\tclickable: true,\n\t\t\t\t\t});\n\t\t\t\t\tAMap.event.addListener(marker, 'click', function() {\n\t\t\t\t\t\t_this.showDetailInfo(item['ddiNo'], item['shopNo']);\n\t\t\t\t\t})\n\n\t\t\t\t\tmarkers.push(marker)\n\t\t\t\t}\n\n\t\t\t\tvar count = markers.length;\n\t\t\t\tvar _renderClusterMarker = function(context) {\n\t\t\t\t\tvar factor = Math.pow(context.count / count, 1 / 18);\n\t\t\t\t\tvar div = document.createElement('div');\n\t\t\t\t\tvar Hue = 180 - factor * 180;\n\t\t\t\t\tvar bgColor = 'hsla(' + Hue + ',100%,50%,0.7)';\n\t\t\t\t\tvar fontColor = 'hsla(' + Hue + ',100%,20%,1)';\n\t\t\t\t\tvar borderColor = 'hsla(' + Hue + ',100%,40%,1)';\n\t\t\t\t\tvar shadowColor = 'hsla(' + Hue + ',100%,50%,1)';\n\t\t\t\t\tdiv.style.backgroundColor = bgColor;\n\t\t\t\t\tvar size = Math.round(30 + Math.pow(context.count / count, 1 / 5) * 20);\n\t\t\t\t\tdiv.style.width = div.style.height = size + 'px';\n\t\t\t\t\tdiv.style.border = 'solid 1px ' + borderColor;\n\t\t\t\t\tdiv.style.borderRadius = size / 2 + 'px';\n\t\t\t\t\tdiv.style.boxShadow = '0 0 1px ' + shadowColor;\n\t\t\t\t\tdiv.innerHTML = context.count;\n\t\t\t\t\tdiv.style.lineHeight = size + 'px';\n\t\t\t\t\tdiv.style.color = fontColor;\n\t\t\t\t\tdiv.style.fontSize = '14px';\n\t\t\t\t\tdiv.style.textAlign = 'center';\n\t\t\t\t\tcontext.marker.setOffset(new AMap.Pixel(-size / 2, -size / 2));\n\t\t\t\t\tcontext.marker.setContent(div)\n\t\t\t\t};\n\n\t\t\t\tif (cluster) {\n\t\t\t\t\tcluster.setMap(null);\n\t\t\t\t}\n\n\t\t\t\tcluster = new AMap.MarkerClusterer(_this.map, markers, {\n\t\t\t\t\tgridSize: 80,\n\t\t\t\t\trenderClusterMarker: _renderClusterMarker\n\t\t\t\t});\n\t\t\t})\n\t\t},\n\n\t}\n}\n",{"version":3,"sources":["wdjyxx.vue"],"names":[],"mappings":";;;;;;;;;AASA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AAIA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA","file":"wdjyxx.vue","sourceRoot":"src/views/rainbow/jsc","sourcesContent":["<template>\r\n\t<div>\r\n\t\t<div style=\"height:630px\" id=\"container\" tabindex=\"0\"></div>\r\n\t\t<Spin size=\"large\" fix v-if=\"showSpin\"></Spin>\r\n\t\t<deviceInfoModal :showModal=\"showDetailModel\" :detailInfo='detailInfo' :transferInfo='transferInfo' :detailTitle=\"detailTitle\" :tabCheck=\"tabCheck\" @closeSpin=\"closeSpin\"></deviceInfoModal>\r\n\t</div>\r\n</template>\r\n\r\n<script>\r\n\timport AMap from 'AMap'\r\n\timport util from '../../../util.js'\r\n\timport data from '../../../data.js'\r\n\t// for axios add finally\r\n\timport promiseFinally from 'promise.prototype.finally';\r\n\tpromiseFinally.shim();\r\n\t\r\n\timport deviceInfo from '../../component/deviceInfo'\r\n\r\n\tvar _this;\r\n\r\n\texport default {\r\n\r\n\t\tname: '设备交易信息',\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tmap: null,\r\n\t\t\t\tdata: [],\r\n\t\t\t\t\r\n\t\t\t\tshowSpin: false,\r\n\t\t\t\t\r\n\t\t\t\tstartDate: util.lastMonth(new Date()),\r\n\t\t\t\tendDate: util.dateFormat(new Date()),\r\n\t\t\t\t\r\n\t\t\t\tshowDetailModel: false, // 控制是否显示详情\r\n\t\t\t\tdetailInfo: {}, // 某条数据下的所有的详情信息\r\n\t\t\t\ttransferInfo: {},\r\n\t\t\t\ttabCheck: \"name1\",\r\n\t\t\t\tdetailTitle: '加载中...',\r\n\t\t\t}\r\n\t\t},\r\n\t\tcomponents: {\r\n\t\t\t'deviceInfoModal': deviceInfo\r\n\t\t},\r\n\t\tmounted() {\r\n\t\t\tthis.init()\r\n\t\t\tthis.queryData()\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\tinit: function() {\r\n\t\t\t\t_this = this;\r\n\r\n\t\t\t\tthis.map = new AMap.Map('container', {\r\n\t\t\t\t\tcenter: [116.397428, 39.90923],\r\n\t\t\t\t\tresizeEnable: true,\r\n\t\t\t\t\tzoom: 11,\r\n\t\t\t\t\tfeatures: ['bg', 'road', 'building'],\r\n\t\t\t\t})\r\n\r\n\t\t\t\tthis.map.plugin(['AMap.ToolBar', 'AMap.Scale', 'AMap.OverView'], function() {\r\n\t\t\t\t\t_this.map.addControl(new AMap.ToolBar())\r\n\t\t\t\t\t_this.map.addControl(new AMap.Scale())\r\n\r\n\t\t\t\t\t// 鹰眼\r\n\t\t\t\t\tvar overView = new AMap.OverView({\r\n\t\t\t\t\t\tvisible: true\r\n\t\t\t\t\t});\r\n\t\t\t\t\toverView.open();\r\n\t\t\t\t\t_this.map.addControl(overView)\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t/*得到详情数据*/\r\n\t\t\tshowDetailInfo(ddiNo, shopNo) {\r\n\t\t\t\t\r\n\t\t\t\tthis.showDetailModel = false;\r\n\t\t\t\t\r\n\t\t\t\tthis.tabCheck = \"name1\"; // 默认刚打开时保证总是显示第一个tab\r\n\t\t\t\r\n\t\t\t\tthis.detailInfo = []; // 置空详情数据，否则打开时仍然是上次的数据\r\n\t\t\t\r\n\t\t\t\tthis.transferInfo = [];\r\n\t\t\t\t\r\n\t\t\t\tthis.queryDetailInfo(ddiNo, shopNo);\r\n\t\t\t\r\n\t\t\t\tthis.queryTransferInfo(ddiNo, shopNo);\r\n\t\t\t\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\tqueryDetailInfo(ddiNo, shopNo) {\r\n\t\t\t\tthis.detailTitle = '加载中...';\r\n\t\t\t\r\n\t\t\t\tthis.showSpin = true;\r\n\t\t\t\r\n\t\t\t\tthis.axios({\r\n\t\t\t\t\t\tmethod: \"get\",\r\n\t\t\t\t\t\turl: \"/rainbow/jqsxxx_detail\",\r\n\t\t\t\t\t\tparams: {\r\n\t\t\t\t\t\t\tfilterMap: {\r\n\t\t\t\t\t\t\t\tddiNo: ddiNo,\r\n\t\t\t\t\t\t\t\tshopValue: shopNo,\r\n\t\t\t\t\t\t\t\tstartDate: this.startDate,\r\n\t\t\t\t\t\t\t\tendDate: this.endDate\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.then(\r\n\t\t\t\t\t\tfunction(response) {\r\n\t\t\t\t\t\t\tconsole.log(JSON.stringify(response))\r\n\t\t\t\r\n\t\t\t\t\t\t\tthis.detailTitle = '详情信息';\r\n\t\t\t\r\n\t\t\t\t\t\t\tthis.detailInfo = response.data.data;\r\n\t\t\t\r\n\t\t\t\t\t\t\tthis.showDetailModel = true;\r\n\t\t\t\r\n\t\t\t\t\t\t}.bind(this)\r\n\t\t\t\t\t)\r\n\t\t\t\t\t.catch(function(error) {\r\n\t\t\t\t\t\t//alert(error);\r\n\t\t\t\t\t\tthis.showSpin = false;\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.finally(function() {\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t}.bind(this));\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\tqueryTransferInfo(ddiNo, shopNo) {\r\n\t\t\t\tthis.showSpin = true;\r\n\t\t\t\r\n\t\t\t\tthis.axios({\r\n\t\t\t\t\t\tmethod: \"get\",\r\n\t\t\t\t\t\turl: \"/rainbow/jqsxxx_transfer_list\",\r\n\t\t\t\t\t\tparams: {\r\n\t\t\t\t\t\t\tfilterMap: {\r\n\t\t\t\t\t\t\t\tddiNo: ddiNo,\r\n\t\t\t\t\t\t\t\tshopValue: shopNo,\r\n\t\t\t\t\t\t\t\tstartDate: this.startDate,\r\n\t\t\t\t\t\t\t\tendDate: this.endDate\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.then(\r\n\t\t\t\t\t\tfunction(response) {\r\n\t\t\t\t\t\t\tconsole.log(JSON.stringify(response))\r\n\t\t\t\r\n\t\t\t\t\t\t\tthis.transferInfo = response.data.data;\r\n\t\t\t\r\n\t\t\t\t\t\t}.bind(this)\r\n\t\t\t\t\t)\r\n\t\t\t\t\t.catch(function(error) {\r\n\t\t\t\t\t\t//alert(error);\r\n\t\t\t\t\t\tthis.showSpin = false;\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.finally(function() {\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t}.bind(this));\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\tcloseSpin() {\r\n\t\t\t\tconsole.log(\"==++++++++++++++++++++============================\")\r\n\t\t\t\tthis.showSpin = false;\r\n\t\t\t}, \r\n\r\n\t\t\tqueryData() {\r\n\t\t\t\tthis.showSpin = true;\r\n\r\n\t\t\t\tthis.axios({\r\n\t\t\t\t\t\tmethod: \"get\",\r\n\t\t\t\t\t\turl: \"/rainbow/wdjyxx\",\r\n\t\t\t\t\t\ttimeout: 1000 * 60 * 2,\r\n\t\t\t\t\t\tparams: {\r\n\t\t\t\t\t\t\tfilterMap: {\r\n\t\t\t\t\t\t\t\tstartDate: this.startDate,\r\n\t\t\t\t\t\t\t\tendDate: this.endDate,\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.then(\r\n\t\t\t\t\t\tfunction(response) {\r\n\t\t\t\t\t\t\tconsole.log(JSON.stringify(response))\r\n\r\n\t\t\t\t\t\t\tvar tempData = response.data.data;\r\n\t\t\t\t\t\t\tthis.data = [];\r\n\r\n\t\t\t\t\t\t\tfor (var i = 0; i < tempData.length; i++) {\r\n\t\t\t\t\t\t\t\tvar item = tempData[i];\r\n\t\t\t\t\t\t\t\tvar ll = item.SHOP_Position.split(',');\r\n\t\t\t\t\t\t\t\tif (ll.length != 2)\r\n\t\t\t\t\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\t\t\t\t\tthis.data.push({\r\n\t\t\t\t\t\t\t\t\tlng: parseFloat(ll[0]),\r\n\t\t\t\t\t\t\t\t\tlat: parseFloat(ll[1]),\r\n\t\t\t\t\t\t\t\t\tcount: item['交易张数总计'],\r\n\t\t\t\t\t\t\t\t\tddiNo: item['DDI_No'],\r\n\t\t\t\t\t\t\t\t\tshopNo: item['SHOP_No']\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tthis.loadData();\r\n\r\n\t\t\t\t\t\t}.bind(this)\r\n\t\t\t\t\t)\r\n\t\t\t\t\t.catch(function(error) {\r\n\t\t\t\t\t\t//alert(error);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.finally(function() {\r\n\t\t\t\t\t\tthis.showSpin = false;\r\n\t\t\t\t\t}.bind(this));\r\n\r\n\t\t\t},\r\n\r\n\t\t\tloadData() {\r\n\r\n\t\t\t\tconsole.log(this.data)\r\n\r\n\t\t\t\tvar heatmap;\r\n\t\t\t\tAMap.plugin([\"AMap.Heatmap\"], function() {\r\n\t\t\t\t\t//初始化heatmap对象\r\n\t\t\t\t\theatmap = new AMap.Heatmap(_this.map, {\r\n\t\t\t\t\t\tradius: 25, //给定半径\r\n\t\t\t\t\t\topacity: [0, 0.8]\r\n\t\t\t\t\t\t/*,\r\n\t\t\t\t\t\tgradient:{\r\n\t\t\t\t\t\t    0.5: 'blue',\r\n\t\t\t\t\t\t    0.65: 'rgb(117,211,248)',\r\n\t\t\t\t\t\t    0.7: 'rgb(0, 255, 0)',\r\n\t\t\t\t\t\t    0.9: '#ffea00',\r\n\t\t\t\t\t\t    1.0: 'red'\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t */\r\n\t\t\t\t\t});\r\n\t\t\t\t\t//设置数据集：该数据为北京部分“公园”数据\r\n\t\t\t\t\theatmap.setDataSet({\r\n\t\t\t\t\t\tdata: _this.data,\r\n\t\t\t\t\t\tmax: 100\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\r\n\r\n\r\n\t\t\t\tvar cluster, markers = [];\r\n\t\t\t\tAMap.plugin(['AMap.MarkerClusterer'], function() {\r\n\t\t\t\t\tfor (var i = 0; i < _this.data.length; i += 1) {\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tvar item = _this.data[i];\r\n\r\n\t\t\t\t\t\tvar marker = new AMap.Marker({\r\n\t\t\t\t\t\t\tposition: [item['lng'], item['lat']],\r\n\t\t\t\t\t\t\tcontent: '<div style=\"background-color: hsla(180, 100%, 50%, 0.7); height: 24px; width: 24px; border: 1px solid hsl(180, 100%, 40%); border-radius: 12px; box-shadow: hsl(180, 100%, 50%) 0px 0px 1px;\"></div>',\r\n\t\t\t\t\t\t\toffset: new AMap.Pixel(-15, -15),\r\n\t\t\t\t\t\t\tclickable: true,\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tAMap.event.addListener(marker, 'click', function() {\r\n\t\t\t\t\t\t\t_this.showDetailInfo(item['ddiNo'], item['shopNo']);\r\n\t\t\t\t\t\t})\r\n\r\n\t\t\t\t\t\tmarkers.push(marker)\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar count = markers.length;\r\n\t\t\t\t\tvar _renderClusterMarker = function(context) {\r\n\t\t\t\t\t\tvar factor = Math.pow(context.count / count, 1 / 18);\r\n\t\t\t\t\t\tvar div = document.createElement('div');\r\n\t\t\t\t\t\tvar Hue = 180 - factor * 180;\r\n\t\t\t\t\t\tvar bgColor = 'hsla(' + Hue + ',100%,50%,0.7)';\r\n\t\t\t\t\t\tvar fontColor = 'hsla(' + Hue + ',100%,20%,1)';\r\n\t\t\t\t\t\tvar borderColor = 'hsla(' + Hue + ',100%,40%,1)';\r\n\t\t\t\t\t\tvar shadowColor = 'hsla(' + Hue + ',100%,50%,1)';\r\n\t\t\t\t\t\tdiv.style.backgroundColor = bgColor;\r\n\t\t\t\t\t\tvar size = Math.round(30 + Math.pow(context.count / count, 1 / 5) * 20);\r\n\t\t\t\t\t\tdiv.style.width = div.style.height = size + 'px';\r\n\t\t\t\t\t\tdiv.style.border = 'solid 1px ' + borderColor;\r\n\t\t\t\t\t\tdiv.style.borderRadius = size / 2 + 'px';\r\n\t\t\t\t\t\tdiv.style.boxShadow = '0 0 1px ' + shadowColor;\r\n\t\t\t\t\t\tdiv.innerHTML = context.count;\r\n\t\t\t\t\t\tdiv.style.lineHeight = size + 'px';\r\n\t\t\t\t\t\tdiv.style.color = fontColor;\r\n\t\t\t\t\t\tdiv.style.fontSize = '14px';\r\n\t\t\t\t\t\tdiv.style.textAlign = 'center';\r\n\t\t\t\t\t\tcontext.marker.setOffset(new AMap.Pixel(-size / 2, -size / 2));\r\n\t\t\t\t\t\tcontext.marker.setContent(div)\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tif (cluster) {\r\n\t\t\t\t\t\tcluster.setMap(null);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tcluster = new AMap.MarkerClusterer(_this.map, markers, {\r\n\t\t\t\t\t\tgridSize: 80,\r\n\t\t\t\t\t\trenderClusterMarker: _renderClusterMarker\r\n\t\t\t\t\t});\r\n\t\t\t\t})\r\n\t\t\t},\r\n\r\n\t\t}\r\n\t}\r\n</script>\n"]}]}